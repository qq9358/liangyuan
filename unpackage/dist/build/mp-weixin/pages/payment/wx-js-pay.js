(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/payment/wx-js-pay"],{"016e":function(e,t,n){"use strict";(function(e){n("db7e");r(n("66fd"));var t=r(n("4bbf"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"4bbf":function(e,t,n){"use strict";n.r(t);var r=n("9c06"),o=n("e065");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("fce2");var i,u=n("f0c5"),c=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,"6f862da0",null,!1,r["a"],i);t["default"]=c.exports},"9c06":function(e,t,n){"use strict";var r={tuiModal:function(){return n.e("components/thorui/tui-modal/tui-modal").then(n.bind(null,"a273"))}},o=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}))},a500:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(n("4795")),o=c(n("a70c")),a=c(n("caf4")),i=c(n("4a8c")),u=(c(n("1b0f")),c(n("ed00")));function c(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(s){return void n(s)}u.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,u,"next",e)}function u(e){s(a,r,o,i,u,"throw",e)}i(void 0)}))}}var d={data:function(){return{countdownText:"",totalMoney:0,timer:-1,queryTimer:-1,saving:!1,shouldConfirm:!0,listNo:"",modal:!1}},computed:{product:function(){return e.getStorageSync("Pay:Product")}},onLoad:function(t){var n=this;return l(r.default.mark((function i(){var u,c,s,l;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,n.listNo=t.listNo,r.next=4,a.default.getNetPayOrderAsync(n.listNo);case 4:if(u=r.sent,n.totalMoney=u.payMoney,!(u.expireSeconds<=0)){r.next=11;break}return n.shouldConfirm=!1,n.$router.push({name:"tickettype"}),e.showTabBar({url:"/pages/index/index"}),r.abrupt("return");case 11:c=(0,o.default)("2018-01-01 00:00:00"),s=c.clone().addSeconds(u.expireSeconds),l=u.expireSeconds>3600?"HH:mm:ss":"mm:ss",n.countdownText=s.format(l),n.timer=setInterval((function(){s=s.addSeconds(-1),n.countdownText=s.format(l),s.isSame(c)&&a.default.getNetPayOrderAsync(n.listNo).then((function(t){n.clear(),n.shouldConfirm=!1,t.paySuccess?e.redirectTo({url:"/pages/order/order-detail?listNo="+n.listNo}):n.$dialog.alert({title:"支付超时订单已取消"}).then((function(){e.redirectTo({url:"/pages/index/index"})}))}))}),1e3),r.next=21;break;case 18:r.prev=18,r.t0=r["catch"](0),console.log(r.t0);case 21:case"end":return r.stop()}}),i,null,[[0,18]])})))()},beforeRouteLeave:function(e,t,n){if(!this.shouldConfirm||e.meta.shouldNotConfirm)return this.clear(),void n();this.modal=!0,n(!1)},methods:{pay:function(){var t=this;return l(r.default.mark((function n(){var o,c,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t.saving=!0,n.next=4,a.default.miniProgramPayAsync(t.listNo);case 4:return o=n.sent,n.next=7,e.getProvider();case 7:return c=n.sent,console.log(c),s=JSON.parse(o),n.next=12,e.requestPayment({provider:c,timeStamp:s.timeStamp,nonceStr:s.nonceStr,package:s.package,signType:s.signType,paySign:s.paySign,success:function(e){console.log(e)},fail:function(e){console.log(e),"requestPayment:fail cancel"!=e.errMsg&&(i.default.logError(e.errMsg),u.default.noneToast(e.errMsg))},complete:function(e){console.log(e)}});case 12:console.log(o),e.showLoading({title:"查询支付结果..."}),t.queryTimer=setInterval((function(){a.default.getNetPayOrderAsync(t.listNo).then((function(e){e.paySuccess&&(t.clear(),t.shouldConfirm=!1,t.$router.replace({name:"orderdetail",params:{listNo:t.listNo}}))}))}),3e3),n.next=22;break;case 17:if(n.prev=17,n.t0=n["catch"](0),"get_brand_wcpay_request:cancel"!=n.t0.err_msg){n.next=21;break}return n.abrupt("return");case 21:i.default.logError(n.t0);case 22:return n.prev=22,t.saving=!1,n.finish(22);case 25:case"end":return n.stop()}}),n,null,[[0,17,22,25]])})))()},clear:function(){clearInterval(this.timer),clearInterval(this.queryTimer)},handleClick:function(t){var n=t.index;0===n||(this.clear(),this.shouldConfirm=!1,e.navigateTo({url:"/pages/order/order-detail?listNo=".concat(this.listNo)})),this.hide()},hide:function(){this.modal=!1}}};t.default=d}).call(this,n("543d")["default"])},e065:function(e,t,n){"use strict";n.r(t);var r=n("a500"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},f485:function(e,t,n){},fce2:function(e,t,n){"use strict";var r=n("f485"),o=n.n(r);o.a}},[["016e","common/runtime","common/vendor"]]]);